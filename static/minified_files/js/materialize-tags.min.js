(function($){"use strict";var defaultOptions={tagClass:tagClass,itemValue:itemValue,itemText:itemText,itemTitle:itemTitle,freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[9,13,44,188],onTagExists:onTagExists,trimValue:true,allowDuplicates:false,deleteTagsOnBackspace:true,deleteTagsOnDeleteKey:true,MoveTagOnLeftArrow:true,MoveTagOnRightArrow:true,autoselect:false,CapitalizeFirstLetterOnly:false,prefilled:null};function tagClass(item){return"chip"}function itemValue(item){return item?item.toString():item}function itemText(item){return this.itemValue(item)}function itemTitle(item){return null}function onTagExists(item,$tag){$tag.hide().fadeIn()}function selectFirstSuggestion(){$(".tt-suggestion.tt-selectable").first().addClass("tt-cursor");console.log($(".tt-suggestion.tt-selectable"))}function TagsMaterialize(element,options){this.itemsArray=[];this.$element=$(element);this.$element.hide();this.objectItems=options&&options.itemValue;this.placeholderText=element.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=$('<div class="materialize-tags"></div>');this.$input=$('<input type="text" class="n-tag" style="border: none;" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$label=this.$element.parent().find("label");this.$element.before(this.$container);this.build(options);this.$label.on("click",function(){$(this).addClass("active");$(this).next(".materialize-tags").find("input.n-tag").focus()});this.$input.on("focus",function(){var label=$(this).parents(".materialize-tags").parent().find("label");$(this).parents(".materialize-tags").addClass("active");if(!label.hasClass("active")){label.addClass("active")}}).on("focusout",function(){var parentContainer=$(this).parents(".materialize-tags"),tags=parentContainer.find("span.chip");parentContainer.removeClass("active");if(tags.length==0&&$(this).val().length==0){parentContainer.parent().find("label").removeClass("active")}})}TagsMaterialize.prototype={constructor:TagsMaterialize,add:function(item,dontPushVal,options){var self=this;if(self.options.maxTags&&self.itemsArray.length>=self.options.maxTags){return}if(item!==false&&!item){return}if(typeof item==="string"&&self.options.trimValue){item=$.trim(item)}if(typeof item==="string"&&self.options.CapitalizeFirstLetterOnly){item=item.charAt(0).toUpperCase()+item.slice(1)}if(typeof item==="object"&&!self.objectItems){throw"Can't add objects when itemValue option is not set"}if(item.toString().match(/^\s*$/)){return}if(typeof item==="string"&&this.$element[0].tagName==="INPUT"){var items=item.split(",");if(items.length>1){for(var i=0;i<items.length;i++){this.add(items[i],true)}if(!dontPushVal){self.pushVal()}return}}var itemValue=self.options.itemValue(item),itemText=self.options.itemText(item),tagClass=self.options.tagClass(item),itemTitle=self.options.itemTitle(item);var existing=$.grep(self.itemsArray,function(item){return self.options.itemValue(item)===itemValue})[0];if(existing&&!self.options.allowDuplicates){if(self.options.onTagExists){var $existingTag=$(".tag",self.$container).filter(function(){return $(this).data("item")===existing});self.options.onTagExists(item,$existingTag)}return}if(self.items().toString().length+item.length+1>self.options.maxInputLength){return}var beforeItemAddEvent=$.Event("beforeItemAdd",{item:item,cancel:false,options:options});self.$element.trigger(beforeItemAddEvent);if(beforeItemAddEvent.cancel){return}self.itemsArray.push(item);var $tag=$('<span id="tag-'+itemValue+'" class="'+htmlEncode(tagClass)+(itemTitle!==null?'" title="'+itemTitle:"")+'">'+htmlEncode(itemText)+' <i class="fa fa-close material-tags-close" data-role="remove"></i></span>');$tag.data("item",item);self.findInputWrapper().before($tag);$tag.after(" ");if(!dontPushVal){self.pushVal()}if(self.options.maxTags===self.itemsArray.length||self.items().toString().length===self.options.maxInputLength){self.$container.addClass("materialize-tags-max");self.$input.blur();self.$input.prop("readOnly",true)}self.$element.trigger($.Event("itemAdded",{item:item,options:options}))},remove:function(item,dontPushVal,options){var self=this;if(self.objectItems){if(typeof item==="object"){item=$.grep(self.itemsArray,function(other){return self.options.itemValue(other)==self.options.itemValue(item)})}else{item=$.grep(self.itemsArray,function(other){return self.options.itemValue(other)==item})}item=item[item.length-1]}if(item){var beforeItemRemoveEvent=$.Event("beforeItemRemove",{item:item,cancel:false,options:options});self.$element.trigger(beforeItemRemoveEvent);if(beforeItemRemoveEvent.cancel){return}$(".chip",self.$container).filter(function(){return $(this).data("item")===item}).remove();if($.inArray(item,self.itemsArray)!==-1){self.itemsArray.splice($.inArray(item,self.itemsArray),1)}}if(!dontPushVal){self.pushVal()}if(self.options.maxTags>self.itemsArray.length){self.$container.removeClass("materialize-tags-max");self.$input.prop("readOnly",false)}if(self.itemsArray.length==0){self.$input.siblings("label").first().removeClass("active")}self.$input.blur();self.$element.trigger($.Event("itemRemoved",{item:item,options:options}))},removeAll:function(){var self=this;$(".chip",self.$container).remove();while(self.itemsArray.length>0){self.itemsArray.pop()}self.pushVal();self.$container.removeClass("materialize-tags-max");self.$input.siblings("label").first().removeClass("active");self.$input.prop("readOnly",false);self.$input.blur()},refresh:function(){var self=this;$(".chip",self.$container).each(function(){var $tag=$(this),item=$tag.data("item"),itemValue=self.options.itemValue(item),itemText=self.options.itemText(item),tagClass=self.options.tagClass(item);$tag.attr("class",null);$tag.addClass("tag "+htmlEncode(tagClass));$tag.contents().filter(function(){return this.nodeType==3})[0].nodeValue=htmlEncode(itemText)})},items:function(){return this.itemsArray},pushVal:function(){var self=this,val=$.map(self.items(),function(item){return self.options.itemValue(item).toString()});self.$element.val(val,true).trigger("change");self.$input.typeahead("val","")},build:function(options){var self=this;self.options=$.extend({},defaultOptions,options);if(self.objectItems){self.options.freeInput=false}makeOptionItemFunction(self.options,"itemValue");makeOptionItemFunction(self.options,"itemText");makeOptionFunction(self.options,"tagClass");if(self.options.typeaheadjs){var typeaheadConfig=null;var typeaheadDatasets={};var typeaheadjs=self.options.typeaheadjs;if($.isArray(typeaheadjs)){typeaheadConfig=typeaheadjs[0];typeaheadDatasets=typeaheadjs[1]}else{typeaheadDatasets=typeaheadjs}self.$input.typeahead(typeaheadConfig,typeaheadDatasets).on("typeahead:selected",$.proxy(function(obj,datum){if(typeaheadDatasets.valueKey){self.add(datum[typeaheadDatasets.valueKey])}else{self.add(datum)}self.$input.typeahead("val","")},self))}self.$container.on("click",$.proxy(function(event){if(!self.$element.attr("disabled")){self.$input.removeAttr("disabled")}self.$input.focus()},self));if(self.options.addOnBlur&&self.options.freeInput){self.$input.on("focusout",$.proxy(function(event){self.add(self.$input.val())},self))}self.$container.on("keydown","input",$.proxy(function(event){var $input=$(event.target),$inputWrapper=self.findInputWrapper();if(self.$element.attr("disabled")){self.$input.attr("disabled","disabled");return}switch(event.which){case 8:if(self.options.deleteTagsOnBackspace&&doGetCaretPosition($input[0])===0){var prev=$inputWrapper.prev();if(prev){self.remove(prev.data("item"))}}break;case 46:if(self.options.deleteTagsOnDeleteKey&&doGetCaretPosition($input[0])===0){var next=$inputWrapper.next();if(next){self.remove(next.data("item"))}}break;case 37:var $prevTag=$inputWrapper.prev();if(self.options.MoveTagOnLeftArrow&&$input.val().length===0&&$prevTag[0]){$prevTag.before($inputWrapper);$input.focus()}break;case 39:var $nextTag=$inputWrapper.next();if(self.options.MoveTagOnRightArrow&&$input.val().length===0&&$nextTag[0]){$nextTag.after($inputWrapper);$input.focus()}break;default:}var textLength=$input.val().length,wordSpace=Math.ceil(textLength/5),size=textLength+wordSpace+1;$input.attr("size",Math.max(this.inputSize,$input.val().length))},self));self.$container.on("keydown","input",$.proxy(function(event){var $input=$(event.target);if(self.$element.attr("disabled")){self.$input.attr("disabled","disabled");return}var text=$input.val(),maxLengthReached=self.options.maxChars&&text.length>=self.options.maxChars;if(self.options.freeInput&&(keyCombinationInList(event,self.options.confirmKeys)||maxLengthReached)){self.add(maxLengthReached?text.substr(0,self.options.maxChars):text);$input.val("");self.$input.typeahead&&self.$input.typeahead("val","");event.preventDefault()}var textLength=$input.val().length,wordSpace=Math.ceil(textLength/5),size=textLength+wordSpace+1;$input.attr("size",Math.max(this.inputSize,$input.val().length))},self));self.$container.on("click","[data-role=remove]",$.proxy(function(event){if(self.$element.attr("disabled")){return}self.remove($(event.target).closest(".chip").data("item"))},self));if(self.options.itemValue===defaultOptions.itemValue){if(self.$element[0].tagName==="INPUT"){self.add(self.$element.val())}}},destroy:function(){var self=this;self.$container.off("keydown","input");self.$container.off("click","[role=remove]");self.$container.remove();self.$element.removeData("materialtags");self.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var elt=this.$input[0],container=this.$container[0];while(elt&&elt.parentNode!==container){elt=elt.parentNode}return $(elt)}};$.fn.materialtags=function(arg1,arg2,arg3){var results=[];this.each(function(){var materialtags=$(this).data("materialtags");if(!materialtags){materialtags=new TagsMaterialize(this,arg1);$(this).data("materialtags",materialtags);results.push(materialtags);$(this).val($(this).val())}else if(!arg1&&!arg2){results.push(materialtags)}else if(materialtags[arg1]!==undefined){if(materialtags[arg1].length===3&&arg3!==undefined){var retVal=materialtags[arg1](arg2,null,arg3)}else{var retVal=materialtags[arg1](arg2)}if(retVal!==undefined){results.push(retVal)}}});if(typeof arg1=="string"){return results.length>1?results:results[0]}else{return results}};$.fn.materialtags.defaults=defaultOptions;$.fn.materialtags.Constructor=TagsMaterialize;function makeOptionItemFunction(options,key){if(typeof options[key]!=="function"){var propertyName=options[key];options[key]=function(item){return item[propertyName]}}}function makeOptionFunction(options,key){if(typeof options[key]!=="function"){var value=options[key];options[key]=function(){return value}}}var htmlEncodeContainer=$("<div />");function htmlEncode(value){if(value){return htmlEncodeContainer.text(value).html()}else{return""}}function doGetCaretPosition(oField){var iCaretPos=0;if(document.selection){oField.focus();var oSel=document.selection.createRange();oSel.moveStart("character",-oField.value.length);iCaretPos=oSel.text.length}else if(oField.selectionStart||oField.selectionStart=="0"){iCaretPos=oField.selectionStart}return iCaretPos}function keyCombinationInList(keyDownEvent,lookupList){var found=false;$.each(lookupList,function(index,keyCombination){if(typeof keyCombination==="number"&&keyDownEvent.which===keyCombination){found=true;return false}if(keyDownEvent.which===keyCombination.which){var alt=!keyCombination.hasOwnProperty("altKey")||keyDownEvent.altKey===keyCombination.altKey,shift=!keyCombination.hasOwnProperty("shiftKey")||keyDownEvent.shiftKey===keyCombination.shiftKey,ctrl=!keyCombination.hasOwnProperty("ctrlKey")||keyDownEvent.ctrlKey===keyCombination.ctrlKey;if(alt&&shift&&ctrl){found=true;return false}}});return found}$(function(){$("input[data-role=materialtags]").materialtags()})})(window.jQuery);